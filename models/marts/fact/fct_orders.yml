models:
  - name: fct_orders
    description: Orders overview data mart.  One row per order line.
    data_tests:
      - dbt_utils.expression_is_true:
          arguments:
            expression: "TotalExcludingTax = ROUND(Quantity * UnitPrice, 2)"
      - dbt_utils.expression_is_true:
          arguments:
            expression: "TaxAmount = ROUND((Quantity * UnitPrice * TaxRate) / 100.0, 2)"
      - dbt_utils.expression_is_true:
          arguments:
            expression: "TotalIncludingTax = (ROUND(Quantity * UnitPrice, 2) + ROUND((Quantity * UnitPrice * TaxRate) / 100.0, 2))"
    columns:
      - name: OrderKey
        description: The unique order key of the order.
        data_tests:
          - not_null
          - unique
      - name: CityKey
        description: The unique key of the city of the order.
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_cities')
                field: CityKey
      - name: CustomerKey
        description: The unique key of the customer of the order.
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_customers')
                field: CustomerKey
      - name: StockItemKey
        description: The unique key of the stock item of the order.
        data_tests:
          - not_null
          - relationships:
              arguments:
                field: StockItemKey
                to: ref('dim_stock_items')
      - name: OrderDateKey
        description: The date the order occurred.
        data_tests:
          - not_null
          - relationships:
              arguments:
                field: Date
                to: ref('dim_dates')
      - name: PickedDateKey
        description: The date the order was picked for delivery occurred.
        data_tests:
          - relationships:
              arguments:
                field: Date
                to: ref('dim_dates')
      - name: SalesPersonKey
        description: The unique key of the sales person of the order.
        data_tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_employees')
                field: EmployeeKey
      - name: PickerKey
        description: The name of the picker of the order.
        data_tests:
          - relationships:
              arguments:
                field: EmployeeKey
                to: ref('dim_employees')
      - name: WWIOrderID
        description: The unique id of the order from the source table.
        data_tests:
          - not_null
      - name: WWIOrderLineID
        description: The unique id of the order line from the source table.
        data_tests:
          - not_null
          - unique
      - name: Description
        description: The description of the order line.
        data_tests:
          - not_null
      - name: Package
        description: The package of the order.
        data_tests:
          - not_null
      - name: Quantity
        description: The quantity of the order line.
        data_tests:
          - not_null
      - name: UnitPrice
        description: The unit price of the order line.
        data_tests:
          - not_null
      - name: TaxRate
        description: The tax rate of the order line.
        data_tests:
          - not_null
      - name: TotalExcludingTax
        description: The total excluding the tax of the order line.
        data_tests:
          - not_null
      - name: TaxAmount
        description: The tax amount of the order line.
        data_tests:
          - not_null
      - name: TotalIncludingTax
        description: The total including the tax of ther order line.
        data_tests:
          - not_null
      - name: WWICityID
        description: The wwi unique key of the delivery city of the order.
        data_tests:
          - not_null
      - name: WWICustomerID
        description: The wwi unique key of the customer of the order.
        data_tests:
          - not_null
      - name: WWIStockItemID
        description: The wwi unique key of the stock item of the order. 
        data_tests:
          - not_null
      - name: WWISalesPersonID
        description: The wwi unique key of the sales person of the order.
        data_tests:
          - not_null
      - name: WWIPickerID
        description: The wwi unique key of the picker person of the order.
      - name: WWIBackorderID
        description: The unique key of the back order of the order.

semantic_models:
  - name: Orders
    defaults:
      agg_time_dimension:  OrderDateKey
    description: |
      Orders fact table. This table is tracking all orders.  It is one row per order line item.
    model: ref('fct_orders')
    entities:
      - name: OrderKey
        type: primary
      - name: Customer
        type: foreign
        expr: CustomerKey
      - name: StockItem
        type: foreign
        expr: StockItemKey
      - name: OrderDate
        type: foreign
        expr: OrderDateKey
      - name: PickedDate
        type: foreign
        expr: PickedDateKey
      - name: SalesPerson
        type: foreign
        expr: SalesPersonKey
      - name: Picker
        type: foreign
        expr: PickerKey